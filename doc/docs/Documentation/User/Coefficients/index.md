# Coefficients 

This page described how to define and manage coefficients in `SLOTH`.

Definition of coefficients for `SLOTH` is made with a C++ object of type `Coefficients` that is simply a set of C++ object of type [`Coefficient`](#coefficient).


## __Coefficient description__ {#coefficient}

For SLOTH, a `Coefficient` is a C++ object defined by:

- a [`GlobalQuantity`](../Glossary/index.md,)
- a `SLOTH` C++ type `FunctionCoefficient`.

The `FunctionCoefficient` object is not really managed by the user since `SLOTH` provides interfaces with 

- the C++ Mathematical Expression Toolkit Library [ExprTk](https://www.partow.net/programming/exprtk/),
- the Python library for symbolic mathematics [Sympy](https://docs.sympy.org/latest/index.html).

### __Sympy interface__ {#coef_sympy}

The `Sympy` interface corresponds to a Python script (see the `script/GenerateCoefficient.py` file in the `SLOTH` repository) which automatically generates the expected `FunctionCoefficient`-type classes from a JSON file.

!!! example "Use of the `GenerateCoefficient.py` with a JSON file named `ExampleCoefficient.json`"
    ```shell
    python3 GenerateCoefficient.py -f ExampleCoefficient.json
    ```

!!! remark "On the first and second-order derivatives"
    The Sympy interface automatically generates the C++ code not only for the function but also its first and second-order derivatives.

This file is composed of a list of JSON objects defined by four pairs (key, value). All values are of type string.
The available and mandatory keys are:

- "expression" : analytical expression of the function,
- "variables" : variables used in the _expression_,
- "class_name" : name of the `FunctionCoefficient`-type class, ready for use in a `Coefficient`,
- "outputfile" : basename of the C++ file where the _class_name_ is generated.

!!! example "Example of JSON file used to generate `FunctionCoefficient`-type object"

    ```json
    [
        {
        "expression":"2*x*x+30*x*y+0.1*z*x*y",
        "variables":"x y z",
        "class_name":"FunctionB",
        "outputfile":"OtherFunction"
        }
    ]
    ```

    In this example, a mathematical function of three variables is defined. The `FunctionCoefficient`-type object will named `FunctionB` and generated by the Sympy interface in the `OtherFunction.hpp` file. 

Once the `FunctionCoefficient`-type classes are generated, they can be used to define a `Coefficient`. 

!!! example "Example of `Coefficient` definition using a `FunctionCoefficient`-type object generated by the `Sympy` interface"

    ```c++
    Coefficient coeffB(Glossary::Temperature, FunctionB());
    ```

    This example shows the definition of a coefficient that correspond to a temperature. This coefficient is associated with the `FunctionB` object generated by the python script `script/GenerateCoefficient.py`.

### __ExprTk interface__ {#coef_exprtk}

Unlike the `Sympy` interface, the `ExprTk` interface does not provides the C++ code for the analytical expression or its derivatives. 

To use this interface, the user can define a `Coefficient` by passing the literal expression of the function (`std::string` type), the unknowns (`std::string` type), and optionally the derivatives (`std::vector<std::string>` type).

!!! warning "Storage of the first and second-order derivatives" 
    Derivatives are stored in `std::vector<std::string>`, considering a row-major index for the Hessian matrix ($`H(i,j)=H(i*n+j)`$ where $`n`$ is the number of unknowns).


!!! example "Definition of a `Coefficient` using the `ExprTk` interface"
    
    The following example defines the temperature coefficient as a constant. In this case, the derivatives are zero.

    ```c++
    Coefficient coeffA(Glossary::Temperature, "2"); 
    ```
    
    The following example defines the temperature coefficient as a multi-variables function. In this case, the derivatives are zero since they are not provided.

    ```c++
    Coefficient coeffA(Glossary::Temperature, "2*x+30*y+0.1*z", "x", "y", "z"); 
    ```
    
    The following example defines the temperature coefficient as a multi-variables function with its first-order derivatives. In this case, the second-order derivatives are zero since they are not provided.

    ```c++
      std::string function = "2*x*x+30*x*y+0.1*z*x*y";
      std::string gx = "4*x+30*y+0.1*z*y";
      std::string gy = "30*x+0.1*z*x";
      std::string gz = "0.1*x*y";
      std::vector<std::string> grad_functions{gx, gy, gz};

      Coefficient coeffA(Glossary::Temperature, grad_functions, function, "x", "y","z");
    ```
    
    The following example defines the temperature coefficient as a multi-variables function with its first and second-order derivatives.

    ```c++
      std::string function = "2*x*x+30*x*y+0.1*z*x*y";
      std::string gx = "4*x+30*y+0.1*z*y";
      std::string gy = "30*x+0.1*z*x";
      std::string gz = "0.1*x*y";
      std::vector<std::string> grad_functions{gx, gy, gz};
      std::string gxx = "4.0";
      std::string gxy = "30+0.1*z";
      std::string gxz = "0.1*y";
      std::string gyx = "30+0.1*z";
      std::string gyy = "0.0";
      std::string gyz = "0.1*x";
      std::string gzx = "0.1*y";
      std::string gzy = "0.1*x";
      std::string gzz = "0.0";
      std::vector<std::string> hess_functions{gxx, gxy, gxz, gyx, gyy, gyz, gzx, gyz, gzz};

      Coefficient coeffA(Glossary::Temperature, hess_functions, grad_functions, function, "x", "y","z");
    ```



## __Coefficients__ {#coefficients}

The C++ class `Coefficients` allows to define a collection of [`Coefficient` objects](#coefficient). 

<!-- Each `SLOTH` problem (see [Problems](../MultiPhysicsCouplingScheme/Problems/index.md) for more details) requires a `Coefficients` object as input argument. -->


!!! example "Example of `Coefficients` definition"

    ```c++
    Coefficient coeffA(Glossary::Temperature, "2*x+30*y+0.1*z", "x", "y", "z");
    Coefficient coeffB(Glossary::Temperature, FunctionB());
    
    Coefficients coeffAB = Coefficients(coeffA, coeffB);
    ```

    This example shows the definition of two coefficients gathered within a `Coefficients` object.
    The first coefficient is defined from the `ExprTk` interface and the second coefficient from the `Sympy` interface.

